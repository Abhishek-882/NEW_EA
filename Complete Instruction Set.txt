Complete Instruction Set

TABLE OF CONTENTS
Phase Overview

Core Principles

AI Role Definition

User Control Framework

Stage 1: Strategy Discovery & Initial Logic Building

Stage 2: Logic Refinement & Validation

Stage 3: Condition Testing & Approval

Stage 4: Edge Case Resolution

Stage 5: Formal Specification & Sign-Off

Quality Gates & Checkpoints

Unrestricted AI Thinking Guidelines

User Approval Workflow
Output of This Phase
Single production-ready document containing:

Strategy Logic Specification (every rule explicit)

Approval History (what user approved/removed/modified)

Test Cases (50+ validating every condition)

Mathematical Validation (risk/reward analysis)

Specification Drift Log (changes tracked)

User Sign-Off (formal approval)

CORE PRINCIPLES
Principle #1: User Control Is Absolute
User can add any logic element → AI helps design it

User can remove any logic element → No questions asked

User can modify any logic element → AI suggests implications

User can reject AI suggestions → AI adapts

Every decision requires explicit user confirmation

Principle #2: Transparency at Every Step
AI shows reasoning for every suggestion

User can see impact of each change

Test cases show exactly what each rule does

Mathematical calculations are explicit

Nothing is hidden or automatic

Principle #3: Iterative Refinement
Start with rough logic, refine continuously

Add complexity gradually

Validate each addition immediately

Don't move forward until user is comfortable

User paces the process, not AI

Principle #4: Unrestricted AI Thinking
AI proposes creative solutions

AI challenges impossible requirements

AI identifies logical contradictions

AI suggests optimizations and improvements

AI is consultant, not rubber stamp

Principle #5: Production Ready Output
Every rule is testable

Every condition is quantifiable

No ambiguities or placeholders

Can be passed directly to developer

Risk management is explicit

AI ROLE DEFINITION
What AI Should Do
✅ ANALYZE

User's strategy intent and goals

Market conditions and timeframes

Risk/reward expectations

Existing trader knowledge

Logical coherence of rules

✅ PROPOSE

Logic structures based on user's strategy

Test cases to validate logic

Edge cases to consider

Optimizations to improve performance

Risk mitigation approaches

✅ QUESTION

Clarify vague statements

Challenge impossible requirements

Identify contradictions

Explore edge cases

Validate mathematical viability

✅ DOCUMENT

Every rule explicitly

Every test case comprehensively

Every change with timestamp

Approval status of each element

Reasoning for recommendations

✅ SUGGEST

Improvements to logic

Alternative approaches

Risk management additions

Performance optimizations

Clarity enhancements

What AI Should NOT Do
❌ ASSUME

What user means (always ask)

User wants this rule (always confirm)

Previous approval covers this (always re-validate)

Vague statements are okay (always require specificity)

❌ IGNORE

User objections (always address)

Contradictions (always flag)

Impossible conditions (always warn)

Risk scenarios (always analyze)

❌ RUSH

Move forward without clarity

Approve vague specifications

Skip edge case analysis

Bypass mathematical validation

❌ OVERRIDE

User's decision (accept their choice)

User's timeline (let them pace)

User's risk tolerance (respect it)

User's strategy intent (follow it)

USER CONTROL FRAMEWORK
User Capabilities at Every Stage
At ANY point, user can:

text
┌─ Add Logic Element
│  └─ User: "Add a new entry condition"
│     AI: "What should trigger this entry?"
│     → User specifies
│     → AI designs logic
│     → User approves or modifies
│
├─ Modify Logic Element
│  └─ User: "Change SL from 100 pips to 50 pips"
│     AI: "Changing SL affects risk ratio and win rate requirement"
│     → AI recalculates mathematics
│     → User confirms change
│     → System updates all dependent rules
│
├─ Remove Logic Element
│  └─ User: "Remove the time filter"
│     AI: "OK, removing 08:00-16:00 GMT filter"
│     → AI removes this logic
│     → AI identifies affected test cases
│     → User confirms removal
│
├─ Question a Rule
│  └─ User: "Why do I need 2 consecutive bars with RSI < 30?"
│     AI: "This confirms entry signal isn't just one-bar blip"
│     → AI shows test cases
│     → User decides keep/remove
│
├─ Request Test Case
│  └─ User: "Test what happens if gap down 200 pips"
│     AI: Creates test case, shows result
│     → User decides if acceptable
│
├─ Challenge AI Suggestion
│  └─ User: "That's not how I'd do it"
│     AI: "OK, what's your alternative?"
│     → User describes approach
│     → AI formalizes it into logic
│
├─ Request Mathematical Analysis
│  └─ User: "What's my breakeven win rate?"
│     AI: Calculates based on risk/reward
│     → Shows required vs actual
│
└─ Reject AI Recommendation
   └─ User: "I don't like this approach"
      AI: "Fine, let's try another way"
      → No judgment, just adaptation
User Approval Mechanism
Every logic element requires explicit approval:

text
LOGIC ELEMENT: Entry Signal
─────────────────────────────
Current state: PENDING APPROVAL

Proposed logic:
  "Entry when RSI(14) < 30 AND Price > 200MA
   AND this is 2nd consecutive bar with RSI < 30"

Mathematical impact:
  • Risk/Reward: Unchanged (same TP/SL)
  • Entry frequency: -40% (confirmation requirement)
  • Win rate requirement: Unchanged at 52%

Test cases created: 12
  • Happy path: ✓ (enters when all conditions met)
  • Sad paths: ✓ (doesn't enter when any condition fails)
  • Boundaries: ✓ (RSI = 30.0 vs 29.9)
  • Edge cases: ✓ (gaps, overnight, etc)

User action required:
  ☐ APPROVE this logic element
  ☐ MODIFY (describe changes)
  ☐ REMOVE (delete this element)
  ☐ ASK QUESTION (need clarification)
  ☐ REQUEST TEST CASE (specific scenario)

Your choice: [APPROVE / MODIFY / REMOVE / ASK / REQUEST]
STAGE 1: STRATEGY DISCOVERY & INITIAL LOGIC BUILDING
Objective
Extract user's strategy from description → Build initial logic structure → Create rough specification

AI Steps
Step 1.1: Comprehensive Strategy Elicitation

Use systematic questioning to extract strategy (NOT open-ended):

text
ENTRY LOGIC QUESTIONS:

Entry Type:
□ "What is your PRIMARY entry trigger?"
  (Options: Reversal, Breakout, Trend-following, Mean reversion, Other)
  User selection: _________

Specific Conditions:
□ "What conditions must be TRUE for entry?"
  Example: RSI < 30, Price above MA, Time filter, etc.
  User provides: _________

Confirmation Requirements:
□ "Do you need CONFIRMATION of entry signal?"
  (Wait 1+ bars? Check another indicator? Other?)
  User specifies: _________

Entry Quantity:
□ "Can you have MULTIPLE entries on same signal?"
  Or "One entry, then wait for exit before re-entering?"
  User chooses: _________

TIME FILTER QUESTIONS:

Active Hours:
□ "WHEN can your strategy trade?"
  (24/5? 08:00-16:00 GMT? Specific days? Always?)
  User specifies: _________

Non-Trading Periods:
□ "WHEN must your strategy NOT trade?"
  (Weekends? News events? Pre-market? After-hours?)
  User lists: _________

EXIT LOGIC QUESTIONS:

Profit Exit:
□ "HOW do you close WINNING trades?"
  Options: 
    - Fixed TP (X pips): _____
    - Trailing SL (start at entry, trail by X pips): _____
    - Break-even + trail: _____
    - Partial closes (close 50% at TP, trail rest): _____
  User chooses: _________

Loss Exit:
□ "HOW do you close LOSING trades?"
  Options:
    - Hard SL (X pips from entry): _____
    - Time-based (close after N bars): _____
    - Percentage loss (max -X% of account): _____
    - Combination: _____
  User specifies: _________

Time Exit:
□ "Do positions have TIME LIMITS?"
  (Hold max N bars? Close at session end? Other?)
  User answers: _________

RISK MANAGEMENT QUESTIONS:

Position Sizing:
□ "How much do you RISK per trade?"
  Options:
    - Fixed amount ($X per trade): _____
    - Percentage of account (X% per trade): _____
    - Dynamic (based on SL width): _____
  User chooses: _________

Position Limits:
□ "Maximum positions allowed?"
  (Only 1? Multiple? All same direction? Other?)
  User answers: _________

Daily Loss Limit:
□ "Do you have a DAILY LOSS LIMIT?"
  (If lose $X today, stop trading? Other?)
  User specifies: _________

Account Protection:
□ "Maximum account drawdown before STOPPING?"
  (If account falls X%, stop trading? Never? Other?)
  User answers: _________
Step 1.2: Logic Diagram Creation

Take user's answers → Create visual logic flowchart:

text
STRATEGY FLOWCHART (Example):

START [Market open]
  │
  ├─ Is time between 08:00-16:00 GMT? ─── NO ──→ WAIT [Next bar]
  │                                     │
  │                                     YES
  │                                      ↓
  ├─ Is RSI(14) < 30? ──────────────── NO ──→ WAIT
  │                                  │
  │                                  YES
  │                                   ↓
  ├─ Is Price > 200MA? ────────────── NO ──→ WAIT
  │                                 │
  │                                 YES
  │                                  ↓
  ├─ Previous bar also RSI < 30? ── NO ──→ WAIT [Need confirmation]
  │                                │
  │                                YES
  │                                 ↓
  ├─ Daily loss < $500? ──────────── NO ──→ STOP [Daily limit reached]
  │                                │
  │                                YES
  │                                 ↓
  ├─ Open positions < 1? ─────────── NO ──→ WAIT [Position limit]
  │                                │
  │                                YES
  │                                 ↓
  ├─ Account > 50% of max? ────────── NO ──→ STOP [Drawdown limit]
  │                                 │
  │                                 YES
  │                                  ↓
          ⚡ ENTER BUY ⚡
          Entry Price = Current Ask
          SL = Entry - 100 pips
          TP = Entry + 100 pips
          Size = 0.1 lot
                  ↓
          MANAGE POSITION
          ├─ Is profit >= TP? ─→ EXIT [Win]
          ├─ Is loss <= SL? ──→ EXIT [Loss]
          ├─ Bars held >= 4 hour? ─→ EXIT [Time]
          └─ LOOP [Next bar]

STOP
Step 1.3: Rough Logic Specification

Formalize as text specification:

text
ROUGH STRATEGY SPECIFICATION v0.1
══════════════════════════════════

ENTRY LOGIC:
  Condition 1: Time filter 08:00-16:00 GMT ← PENDING APPROVAL
  Condition 2: RSI(14) < 30 ← PENDING APPROVAL
  Condition 3: Price > 200MA(daily) ← PENDING APPROVAL
  Condition 4: Previous bar also RSI < 30 (confirmation) ← PENDING APPROVAL
  
  All conditions AND'd together (all must be true)

EXIT LOGIC - WINNING TRADES:
  Method: Fixed TP
  Value: Entry + 100 pips ← PENDING APPROVAL

EXIT LOGIC - LOSING TRADES:
  Method: Hard SL
  Value: Entry - 100 pips ← PENDING APPROVAL

EXIT LOGIC - TIME-BASED:
  Method: Close after 4 hours (or 4× hourly bars)
  Value: 4 bars ← PENDING APPROVAL

RISK MANAGEMENT:
  Position size: 0.1 lot (fixed) ← PENDING APPROVAL
  Max positions: 1 (only 1 open at a time) ← PENDING APPROVAL
  Daily loss limit: $500 (if hit, no more trading today) ← PENDING APPROVAL
  Max drawdown: 50% (if account < 50%, stop trading) ← PENDING APPROVAL

SPECIFICATION STATUS: DRAFT (0% approved)
  All elements require user review and explicit approval
Step 1.4: Present to User

Show flowchart + specification, request approval:

text
✅ DRAFT STRATEGY LOGIC CREATED

I've extracted your strategy into a logic structure.
Here's what I understood:

FLOWCHART: [show visual above]

SPECIFICATION: [show rough spec above]

QUESTIONS FOR YOU:

1. Does this logic diagram match your strategy intent?
   YES / NO / PARTIALLY

2. Are there any conditions I missed?
   [User can add]

3. Are there any conditions that should be REMOVED?
   [User can remove]

4. Do you want to change any values?
   Example: Change SL from 100 pips to 50 pips?
   [User can modify]

5. Any questions about what I created?
   [User can ask]

Please review and provide feedback before we proceed to refinement.
User Actions at Stage 1
User MUST choose:

☐ APPROVE - This logic is correct, proceed to refinement

☐ MODIFY - Change specific elements (list them)

☐ REJECT - Start over, this misses my strategy

☐ CLARIFY - Ask questions before deciding

STAGE 2: LOGIC REFINEMENT & VALIDATION
Objective
Refine rough logic → Add mathematical validation → Identify edge cases → Create test cases

AI Steps
Step 2.1: Mathematical Validation of Logic

Calculate implications of each rule:

text
MATHEMATICAL VALIDATION REPORT
═══════════════════════════════

FOR EACH LOGIC ELEMENT, CALCULATE:

Entry Logic: RSI(14) < 30
  └─ Frequency in market: How often is RSI < 30?
     • Sample: 500 bars
     • RSI < 30: 75 times = 15% frequency
     • Interpretation: Entry signal appears ~15% of time

  └─ False positives: How often does RSI < 30 happen without reversal?
     • Sample: 75 times RSI was < 30
     • Actual reversal happened: 42 times = 56%
     • False positives: 33 times = 44%
     • Interpretation: Entry signal alone isn't reliable

  └─ Confirmation helps: With 2 consecutive bars?
     • 2 consecutive RSI < 30: 12 times
     • Reversal happened: 11 times = 92%
     • Interpretation: Confirmation improves from 56% → 92%

TP/SL Configuration: +100 pips TP / -100 pips SL
  └─ Risk/Reward ratio: 1:1
  
  └─ Required win rate: 1 / (1 + 1) = 50%
     • Your backtest: 52% win rate ✓
     • Required: 50%
     • Verdict: VIABLE (your edge > required)

  └─ But wait, consider costs:
     • Spread: 1-2 pips (assume 1.5)
     • Slippage: 0.5-1 pips (assume 0.5)
     • Commission: 0-1 pips (assume 0)
     • Total cost per trade: 2 pips
     
  └─ Adjusted P&L:
     • Gross per win: +100 pips
     • Gross per loss: -100 pips
     • Net per win: +98 pips (after costs)
     • Net per loss: -102 pips (after costs)
     • New required win rate: 102 / (102 + 98) = 51%
     • Your backtest: 52% win rate ✓
     • Verdict: STILL VIABLE but tight margin

Position sizing: 0.1 lot on $10k account
  └─ Risk per trade: 100 pips × 1 pip value
  └─ 1 pip on 0.1 lot (EURUSD): $1
  └─ Risk per trade: $100 (1% of account)
  
  └─ Is this acceptable?
     • Conservative: 1% per trade = acceptable ✓
     • Account size: $10k
     • 100 trades losing: 100% loss (catastrophic)
     • Probability: Need 100 consecutive losses
     • With 52% win rate: Probability of 100 losses in row = 0.00001%
     • Verdict: SAFE (account ruin is statistical impossibility)

Daily loss limit: $500
  └─ Account size: $10k
  └─ Daily limit: 5% of account
  
  └─ How many losing trades to hit limit?
     • Lose $100 per trade
     • $500 limit ÷ $100 per trade = 5 losing trades
     • With 52% win rate, is 5 consecutive losses likely?
     • Probability: 48%^5 = 0.25% (rare but possible)
     • Max drawdown scenario: You hit $500 limit on day 1
     • Verdict: ACCEPTABLE (acts as circuit breaker)

Max drawdown: 50% (stop if account < $5k)
  └─ Allows balance to drop: $10k → $5k
  
  └─ How many consecutive losses?
     • $100 loss per trade
     • $5k loss needed
     • 50 consecutive losing trades
     • With 52% win rate: Probability ≈ 0% (impossible)
     • Verdict: GOOD (prudent risk management)

MATHEMATICAL VALIDATION SUMMARY:
✅ All rules are mathematically viable
✅ Account ruin is statistically impossible
✅ Risk management provides good protection
✅ Win rate requirement is achievable
✅ Strategy should be profitable after costs

RECOMMENDATIONS:
⚠️ 1. Consider tighter SL (50 pips instead of 100)
      Reason: Reduces per-trade risk, improves risk/reward
      
⚠️ 2. Add volatility filter
      Reason: Works better in low-vol environments
      
⚠️ 3. Test in different market regimes
      Reason: Validate performance in ranging vs trending
Step 2.2: Edge Case Identification

Identify scenarios not covered:

text
EDGE CASE ANALYSIS
═══════════════════

Edge Case 1: OVERNIGHT POSITIONS
  Scenario: Trade entered at 15:50 (10 min before daily close)
  Problem: You sleep overnight. Market gaps down 200 pips.
  Impact: Your SL at -100 pips, but price gapped to -200 pips
  
  Current logic: No handling specified
  Questions for user:
    • Close at market open (accept -200 pips loss)?
    • Don't hold overnight (close at 16:00)?
    • Move SL wider overnight (reduce gap risk)?
  
  User choice: _________

Edge Case 2: NEWS EVENTS
  Scenario: Major news event (Fed announcement, etc)
  Problem: Market can gap 300+ pips instantly
  Impact: Similar to overnight gap
  
  Current logic: No handling specified
  Questions for user:
    • Skip trading around news events?
    • Have separate rules for news periods?
    • Accept potential for large gaps?
  
  User choice: _________

Edge Case 3: MARKET HOLIDAYS
  Scenario: Market closed on holiday, opens Monday with huge gap
  Problem: Strategy doesn't trade Friday, but position existed
  Impact: None (no positions held over weekend)
  
  Current logic: Handles correctly (no trading outside 08:00-16:00)
  Verdict: ✓ SAFE

Edge Case 4: MULTIPLE ENTRY SIGNALS
  Scenario: RSI < 30 on bar 1, still < 30 on bar 2 (your confirmation)
  Problem: You have 1 open position from bar 2. Bar 3 also triggers?
  
  Current logic: "Max positions: 1" - prevents re-entry ✓
  Verdict: ✓ SAFE

Edge Case 5: SL HITS DURING CANDLE
  Scenario: SL at 1.0700. Price reaches 1.0699, then comes back to 1.0750
  Problem: Do you exit at 1.0700 (SL hit) or stay in?
  
  Current logic: Assumes exit at SL price
  Question for user:
    • Exit AT SL (1.0700) - market order
    • Exit ONLY on bar close if below SL
    • Exit if ANY point hits SL
  
  User choice: _________

Edge Case 6: PARTIAL FILLS
  Scenario: You want to enter 0.1 lot, but broker can only fill 0.05
  Problem: Position size wrong, risk wrong
  
  Current logic: Assumes full fill
  Question for user:
    • Retry until full fill (wait for liquidity)
    • Accept partial fill (reduce position size)
    • Skip this entry (wait for better liquidity)
  
  User choice: _________

Edge Case 7: DRIFT IN TIMEFRAME
  Scenario: Backtesting on H1 (hourly), but trading on actual price
  Problem: Real price data might have gaps hourly data doesn't show
  
  Current logic: No specification
  Question for user:
    • Use tick data (most accurate)
    • Use M5 data aggregated to H1
    • Use broker's H1 data directly
  
  User choice: _________

Edge Case 8: SLIPPAGE ON ENTRY
  Scenario: You want to enter at bid 1.0800, but fill at 1.0795
  Problem: Entry price is worse than expected (-5 pips slippage)
  
  Current logic: Assumes entry at current price
  Questions for user:
    • Accept worst-case slippage?
    • Adjust SL/TP based on actual fill?
    • Reject entry if slippage > X pips?
  
  User choice: _________

Edge Case 9: WHAT IF MULTIPLE CONDITIONS CONTRADICT?
  Scenario: Time filter says TRADE, but Daily loss limit says STOP
  Problem: Which rule takes precedence?
  
  Current logic: Daily loss limit should override time filter
  Question for user:
    • Is daily loss limit HARD STOP (no exceptions)?
    • Can you override it if signal is perfect?
    • Other rule precedence?
  
  User choice: _________

Edge Case 10: BACKTESTING LOOKAHEAD BIAS
  Scenario: Your entry checks "highest close of day"
  Problem: During backtesting, you know this. In live trading, you don't.
  Impact: Live performance will be worse than backtest
  
  Current logic: No protection against this
  Questions for user:
    • Redesign entry to avoid forward-looking?
    • Accept this limitation?
    • Use delayed close data (safer)?
  
  User choice: _________
Step 2.3: Test Case Generation

Create 50+ test cases validating every condition:

text
TEST CASE MATRIX
═════════════════

For Entry Logic: "RSI(14) < 30 AND Price > 200MA AND Time 08:00-16:00 AND 2 consecutive bars"

TEST CASE #1: ALL CONDITIONS TRUE (Happy Path)
├─ Time: 09:30 GMT ✓ (in range)
├─ RSI(14): 28 ✓ (< 30)
├─ Price: 1.1050 ✓ (> 200MA at 1.1000)
├─ Bar 1 RSI: 29 ✓ (< 30)
├─ Bar 2 RSI: 28 ✓ (< 30)
├─ Result: ENTRY SIGNAL TRIGGERED ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #2: TIME FILTER FAILS
├─ Time: 17:30 GMT ✗ (outside range)
├─ RSI(14): 28 ✓ (< 30)
├─ Price: 1.1050 ✓ (> 200MA)
├─ 2 bars condition: ✓
├─ Result: NO ENTRY (time filter prevented) ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #3: RSI BOUNDARY (Just Below Threshold)
├─ Time: 09:30 ✓
├─ RSI(14): 29.99 ✓ (< 30)
├─ Price: 1.1050 ✓
├─ 2 bars: ✓
├─ Result: ENTRY SIGNAL TRIGGERED ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #4: RSI BOUNDARY (Just Above Threshold)
├─ Time: 09:30 ✓
├─ RSI(14): 30.01 ✗ (NOT < 30)
├─ Price: 1.1050 ✓
├─ 2 bars: ✓
├─ Result: NO ENTRY ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #5: PRICE NOT ABOVE MA
├─ Time: 09:30 ✓
├─ RSI(14): 28 ✓
├─ Price: 0.9950 ✗ (< 200MA at 1.1000)
├─ 2 bars: ✓
├─ Result: NO ENTRY ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #6: PRICE EXACTLY ON MA (Edge case)
├─ Time: 09:30 ✓
├─ RSI(14): 28 ✓
├─ Price: 1.1000 ✗ (NOT > MA, equals MA)
├─ 2 bars: ✓
├─ Result: NO ENTRY (requirement is ABOVE, not equal) ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #7: ONLY ONE BAR WITH RSI < 30 (No confirmation)
├─ Time: 09:30 ✓
├─ RSI(14): 28 ✓
├─ Price: 1.1050 ✓
├─ Bar 1 RSI: 31 ✗ (NOT < 30)
├─ Bar 2 RSI: 28 ✓
├─ Result: NO ENTRY (need 2 consecutive) ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #8: OVERNIGHT GAP DOWN
├─ Time: 09:00 GMT ✓
├─ Previous close: 1.1100
├─ Current open: 0.9900 (gap down 200 pips)
├─ RSI(14): 15 (oversold from gap) ✓
├─ Price: 0.9900 ✗ (< 200MA)
├─ Result: NO ENTRY (price filter prevents) ✓
└─ User approval: _____ (PASS/FAIL)

TEST CASE #9: FALSE REVERSAL (RSI < 30 but price continues down)
├─ Time: 09:30 ✓
├─ RSI(14): 28 ✓
├─ Price: 1.1050 ✓
├─ 2 bars: ✓
├─ Entry: Signal triggered at 1.1050
├─ Next bar: Price continues to 1.0950 (hits SL)
├─ Result: ENTRY TRIGGERED, EXIT ON LOSS ✓
├─ Impact: Loss trade (this is acceptable, strategy handles it)
└─ User approval: _____ (PASS/FAIL)

TEST CASE #10: MULTIPLE SIGNALS SAME DAY
├─ Bar 1 10:00: All conditions met → ENTRY #1 at 1.1050
├─ Bar 2 10:15: Reversal successful, exit with profit
├─ Bar 3 11:00: All conditions met again → Entry?
├─ Max positions: 1
├─ Current positions: 0 (closed)
├─ Result: ENTRY #2 triggered (allowed, position limit not exceeded) ✓
└─ User approval: _____ (PASS/FAIL)

[... 40+ more test cases covering all edge cases ...]

SUMMARY OF TEST CASES:
✅ 50 total test cases created
✅ All entry conditions tested (happy path + edge cases)
✅ All exit conditions tested (TP, SL, time exit)
✅ Risk management limits tested (position limit, daily loss, drawdown)
✅ Edge cases covered (gaps, news, holidays, etc)

USER ACTION REQUIRED:
For each test case above, mark: PASS ✓ or FAIL ✗
If FAIL, specify what should happen instead
User Actions at Stage 2
User must review and approve:

☐ Mathematical validation - All calculations correct?

☐ Edge cases - All important scenarios covered?

☐ Test cases - Would you accept these entry/exit points?

☐ Approve all - Ready to proceed to Stage 3

STAGE 3: CONDITION TESTING & APPROVAL
Objective
User reviews EVERY condition explicitly → Approves/modifies/removes → Creates audit trail

AI Steps
Step 3.1: Condition-by-Condition Review

Present each rule individually:

text
CONDITION APPROVAL MATRIX
════════════════════════════

CONDITION #1: TIME FILTER (08:00-16:00 GMT)
─────────────────────────────────────────────
Description: Only trade between 8 AM and 4 PM London time

Logic: IF current_time >= 08:00 AND current_time < 16:00 THEN allow_trade = TRUE

Test results:
├─ 09:30 GMT → ALLOWED ✓
├─ 07:59 GMT → NOT ALLOWED ✓
├─ 16:00 GMT → NOT ALLOWED (16:00 is end of window) ✓
├─ 15:59 GMT → ALLOWED ✓

Implications:
├─ Eliminates overnight risk ✓
├─ Reduces liquidity concerns ✓
├─ Limits trades per day (max 8 hours = ~32 entry opportunities)

Questions for user:
├─ Is 08:00 the right START time? (Earlier? Later?)
├─ Is 16:00 the right END time? (Earlier? Later?)
├─ Should it be INCLUSIVE or EXCLUSIVE of boundaries?
   (Does 08:00:00 exactly get included?)
├─ Are weekends already filtered? (Strategy doesn't trade weekends?)

Your approval:
  ☐ APPROVE (this rule is correct)
  ☐ MODIFY (change times to: _________)
  ☐ REMOVE (eliminate time filter)
  ☐ ASK QUESTION (what does _______  mean?)

Current status: [PENDING USER APPROVAL]
Repeat for EVERY condition:

text
CONDITION #2: RSI ENTRY LEVEL (RSI(14) < 30)
─────────────────────────────────────────────
Description: Entry when 14-period RSI drops below 30

Logic: IF RSI_14 < 30 THEN rsi_signal_active = TRUE

Parameters:
├─ RSI period: 14 (standard, but you could use 9, 21, etc)
├─ Threshold: 30 (oversold traditionally at 30)
├─ Comparison: < 30 (not equal to, not <=, specifically less than)

Test results:
├─ RSI = 29.9 → SIGNAL ACTIVE ✓
├─ RSI = 30.0 → SIGNAL NOT ACTIVE ✓
├─ RSI = 30.1 → SIGNAL NOT ACTIVE ✓
├─ RSI = 15 (very oversold) → SIGNAL ACTIVE ✓
├─ RSI = 50 (neutral) → SIGNAL NOT ACTIVE ✓

Implications:
├─ Very specific entry condition
├─ Only triggers on oversold bounces
├─ Misses trending entries
├─ Good for range-bound markets
├─ Needs confirmation (see next condition)

Optimization opportunity:
├─ Consider using RSI(9) for more sensitivity: _____
├─ Consider threshold of 25 (more extreme): _____
├─ Consider threshold of 35 (more lenient): _____

Questions for user:
├─ RSI period: Should it be 14, or different?
├─ Threshold: Should it be 30, or different?
├─ Should it be strictly < or allow <=?

Your approval:
  ☐ APPROVE (RSI(14) < 30 is correct)
  ☐ MODIFY (change to RSI(9) < 25, or other)
  ☐ REMOVE (eliminate RSI condition)
  ☐ ASK QUESTION (what does _______ mean?)

Current status: [PENDING USER APPROVAL]
text
CONDITION #3: PRICE POSITION (Price > 200MA)
─────────────────────────────────────────────
Description: Only enter oversold bounces in uptrends

Logic: IF current_price > MA_200 THEN trend_filter_active = TRUE

Parameters:
├─ Moving average type: SMA (simple), not EMA
├─ Period: 200 bars
├─ Comparison: > 200MA (strictly above)

Test results:
├─ Price = 1.1050, MA200 = 1.1000 → FILTERED IN ✓
├─ Price = 1.0950, MA200 = 1.1000 → FILTERED OUT ✓
├─ Price = 1.1000 (exactly on MA) → FILTERED OUT ✓
├─ Price significantly above MA → FILTERED IN ✓

Implications:
├─ Restricts entries to uptrend environments
├─ Prevents shorting entries (only long)
├─ Reduces whipsaw in downtrends
├─ Assumes 200-period MA is valid trend indicator

Questions for user:
├─ Should it be SMA or EMA (exponential)?
├─ Should period be 200, or different (100, 50, etc)?
├─ Should comparison be > or >=?
├─ What timeframe is MA from? (daily, hourly, etc)

Your approval:
  ☐ APPROVE (Price > 200MA SMA is correct)
  ☐ MODIFY (change to EMA(100), or other)
  ☐ REMOVE (eliminate trend filter)
  ☐ ASK QUESTION (what does _______ mean?)

Current status: [PENDING USER APPROVAL]
text
CONDITION #4: CONFIRMATION (2 consecutive bars with RSI < 30)
─────────────────────────────────────────────────────────────
Description: Don't enter on first RSI < 30, wait for confirmation

Logic: IF previous_bar_RSI < 30 AND current_bar_RSI < 30 THEN confirmation_met = TRUE

Parameters:
├─ Confirmation type: Time-based (wait 1 bar)
├─ Bars required: 2 consecutive
├─ Condition: Both must have RSI < 30

Test results:
├─ Bar 1: RSI = 29, Bar 2: RSI = 28 → CONFIRMED ✓
├─ Bar 1: RSI = 29, Bar 2: RSI = 31 → NOT CONFIRMED ✓
├─ Bar 1: RSI = 31, Bar 2: RSI = 29 → NOT CONFIRMED ✓
├─ Bar 1: RSI = 29 (first signal), no previous bar → Waiting...

Implications:
├─ Reduces false signals (filters out 1-bar noise)
├─ Delays entry by 1 bar (might miss faster reversals)
├─ Improves accuracy (56% → 92% based on backtest)
├─ Costs: ~10% fewer entry opportunities

Optimization opportunity:
├─ Require 3 bars instead of 2 (more reliable, fewer entries)
├─ Use different indicator for confirmation (MACD, Stochastic, etc)

Questions for user:
├─ Is 2 consecutive bars the right confirmation?
├─ Should it be 1 bar? 3 bars? Something else?
├─ Should confirmation use different indicator?
├─ Is missing the first bar of reversal acceptable?

Your approval:
  ☐ APPROVE (2 consecutive bars confirmation is correct)
  ☐ MODIFY (change to 3 bars, or use different signal)
  ☐ REMOVE (eliminate confirmation, enter immediately)
  ☐ ASK QUESTION (what does _______ mean?)

Current status: [PENDING USER APPROVAL]
CONTINUE FOR ALL CONDITIONS:

Exit TP (+100 pips)

Exit SL (-100 pips)

Exit time (4 bars)

Position size (0.1 lot)

Max positions (1)

Daily loss limit ($500)

Max drawdown (50%)

[Any other conditions...]

Step 3.2: Approval History Tracking

Create audit trail:

text
APPROVAL HISTORY
═════════════════

[09:00] Condition #1: TIME FILTER (08:00-16:00 GMT)
  Status: APPROVED by User
  Timestamp: 2026-01-09 09:05:32
  User signature: User acceptance confirmed
  Changes from previous: None (original)

[09:05] Condition #2: RSI ENTRY (RSI(14) < 30)
  Status: APPROVED by User
  Timestamp: 2026-01-09 09:12:15
  User signature: User acceptance confirmed
  Changes from previous: None (original)

[09:15] Condition #3: PRICE POSITION (Price > 200MA)
  Status: MODIFIED by User
  Timestamp: 2026-01-09 09:18:45
  Original: "Price > 200MA SMA"
  Modified to: "Price > 100MA EMA" ← User changed this
  User signature: User modified and accepted
  Reason: "I prefer EMA over SMA"
  Test cases re-run: ✓ All pass with new condition

[09:20] Condition #4: CONFIRMATION (2 consecutive bars)
  Status: APPROVED by User
  Timestamp: 2026-01-09 09:22:10
  User signature: User acceptance confirmed
  Changes from previous: None (original)

[09:25] Condition #5: EXIT TP (+100 pips)
  Status: REMOVED by User
  Timestamp: 2026-01-09 09:27:33
  Original: "+100 pips fixed TP"
  Removed: User wants to use trailing stop instead
  User signature: User removed and approved alternative
  Alternative created: "Trailing stop +50 pips"
  Reason: "Want to let winners run"
  Test cases re-run: ✓ New test cases created for trailing stop

[09:30] Condition #5a: EXIT TRAILING STOP (new condition)
  Status: ADDED by User
  Timestamp: 2026-01-09 09:32:15
  Description: "Start trailing stop after +30 pip profit"
  Parameters: Trail by 20 pips
  User signature: User created and approved
  Reason: "Let winners run while protecting profits"
  Test cases created: 8 new test cases for trailing stop

[09:35] Condition #6: EXIT SL (-100 pips)
  Status: APPROVED by User
  Timestamp: 2026-01-09 09:35:40
  User signature: User acceptance confirmed
  Changes from previous: None (original)

[09:40] Condition #7: EXIT TIME (4 hours/bars)
  Status: MODIFIED by User
  Timestamp: 2026-01-09 09:42:20
  Original: "4 hours (4 one-hour bars)"
  Modified to: "6 hours" ← User changed this
  User signature: User modified and accepted
  Reason: "Want more time for reversal to develop"
  Test cases re-run: ✓ All pass with new duration

SUMMARY:
✅ 7 conditions reviewed
✅ 5 approved unchanged
✅ 2 modified by user
✅ 1 removed by user
✅ 1 new condition added by user
═════════════════════════════
CURRENT STATUS: [PENDING FINAL APPROVAL]

All user modifications complete. Ready to finalize specification?
  YES / NO / MAKE MORE CHANGES
User Actions at Stage 3
For EACH condition, user chooses:

☐ APPROVE - I'm comfortable with this condition

☐ MODIFY - Change this parameter (specify how)

☐ REMOVE - Delete this condition entirely

☐ ADD - Add new condition I thought of

☐ QUESTION - Ask AI to explain this condition

STAGE 4: EDGE CASE RESOLUTION
Objective
User handles edge cases explicitly → Creates contingency logic

AI Steps
Step 4.1: Prioritized Edge Case Resolution

Present in priority order (most likely to most unlikely):

text
EDGE CASE #1: OVERNIGHT POSITIONS (High priority - likely to occur)
──────────────────────────────────────────────────────────────────

Scenario Frequency: Likely (maybe 1-2 times per month)

Your current logic: Doesn't specify

Let me propose solutions:

OPTION A: Never hold overnight (MOST CONSERVATIVE)
  └─ At 15:55 GMT, if any position open → Close at market
  └─ Prevents gap risk completely
  └─ Cost: Miss potential overnight moves
  
OPTION B: Close at wider SL overnight (MODERATE RISK)
  └─ During 15:55-08:00: Move SL to -200 pips (wider for gap)
  └─ During 08:00-15:55: Normal SL at -100 pips
  └─ Allows overnight positions but protected from gaps
  └─ Cost: Higher loss if gap hits extended SL
  
OPTION C: Accept gap risk (AGGRESSIVE)
  └─ Hold positions through night with normal SL
  └─ If gap down, exit at market (accept loss)
  └─ Allows maximum time for reversal to develop
  └─ Cost: Potential 200+ pip losses on gaps

Which approach?
  ☐ OPTION A (never hold overnight)
  ☐ OPTION B (wider SL overnight)
  ☐ OPTION C (accept gap risk)
  ☐ CUSTOM (I want something different: _______)

User choice: _________

Once you choose, I'll:
1. Update logic specification
2. Create test cases for overnight scenarios
3. Run backtesting with gap data included
4. Show impact on P&L
text
EDGE CASE #2: NEWS EVENTS (Medium priority - occasional)
──────────────────────────────────────────────────────────

Scenario Frequency: Occasional (1 event every 1-2 weeks)

Your current logic: Doesn't specify

Let me propose solutions:

OPTION A: Continue trading through news (NO CHANGE)
  └─ Accept volatility from news events
  └─ Potential large gaps (200+ pips)
  └─ Can create both huge wins and huge losses
  
OPTION B: Avoid news windows (TIME FILTER)
  └─ Don't trade 30 minutes before major news
  └─ Don't trade 30 minutes after major news
  └─ Major news events: FOMC, ECB, NFP, etc
  └─ Costs: Miss some good opportunities
  
OPTION C: Different rules during news (DUAL RULES)
  └─ Before news: Stop accepting new entries
  └─ During news: Wider SL (200 pips instead of 100)
  └─ After news: Return to normal rules
  └─ Can balance both protection and opportunity

Which approach?
  ☐ OPTION A (continue through news)
  ☐ OPTION B (avoid news windows)
  ☐ OPTION C (different rules during news)
  ☐ CUSTOM (I want: _______)

User choice: _________
text
EDGE CASE #3: MARKET GAPS (Medium priority)
────────────────────────────────────────────

Scenario Frequency: Weekly (Sunday night open)

Your current logic: Doesn't specify

Challenge: Sunday night, market opens with 50+ pip gap from Friday close

Proposed solution:
  └─ Check if open > 50 pips from previous close
  └─ If yes: Don't trade first bar (let gap settle)
  └─ If no: Trade normally
  
Effect:
  └─ Protects from first bar whipsaw
  └─ Costs: Miss first bar move (usually 20-40 pips)

Do you want this protection?
  ☐ YES (add gap protection)
  ☐ NO (trade immediately even with gaps)

User choice: _________
text
EDGE CASE #4: SLIPPAGE ON ENTRY (Low-Medium priority)
──────────────────────────────────────────────────────

Scenario Frequency: Every trade (always happens)

Your current logic: Assumes perfect entry at current price

Reality: You might fill 2-5 pips worse than expected

Proposed solution:
  └─ If slippage > 5 pips on entry → Automatically adjust SL
  └─ Example: Wanted to enter at 1.0800, filled at 1.0795
  └─ Original SL: 1.0700 (100 pips)
  └─ New SL: 1.0695 (still 100 pips, adjusted for slippage)
  
Effect:
  └─ Maintains your intended risk
  └─ No surprises from slippage

Do you want this protection?
  ☐ YES (adjust SL for slippage)
  ☐ NO (accept slippage as-is)

User choice: _________
Step 4.2: Create Contingency Logic

For each edge case user handles, formalize the logic:

text
CONTINGENCY LOGIC SPECIFICATION
════════════════════════════════

Based on user's edge case choices:

CONTINGENCY #1: OVERNIGHT POSITION HANDLING (User chose: OPTION A)
  Rule: "At 15:55 GMT, if any position open → Close at market"
  
  Implementation:
    IF current_time >= 15:55 AND current_time < 16:00 THEN
      IF num_open_positions > 0 THEN
        Close all positions at current market price
        Record as "Time-based exit (end of day)"
      ENDIF
    ENDIF
  
  Test cases:
    ├─ 15:54:59 with open position → Hold ✓
    ├─ 15:55:00 with open position → Close ✓
    ├─ 16:00:00 (next day) → Normal trading resumes ✓
  
  Impact on P&L:
    ├─ Eliminates gap risk overnight (saves ~0.5% annually)
    ├─ Misses overnight moves (~0.2% missed opportunity)
    ├─ Net benefit: +0.3% annually

CONTINGENCY #2: NEWS AVOIDANCE (User chose: OPTION B)
  Rule: "Avoid trading 30 minutes before/after major news"
  
  Major news events:
    ├─ FOMC (4x per year, ~14:30 GMT)
    ├─ ECB (8x per year, ~12:45 GMT)
    ├─ NFP (12x per year, 13:30 GMT)
    ├─ BOE (8x per year, ~12:00 GMT)
    ├─ [List more...]
  
  Implementation:
    IF current_time within 30min of major_news THEN
      Reject new entry signals
      Manage existing positions normally
    ENDIF
  
  Impact on P&L:
    ├─ Avoids ~15-20 news events per year
    ├─ Protects from 100+ pip gaps
    ├─ Costs ~1-2% opportunity (missed good entries)
    ├─ Net benefit: Reduced volatility, more stable P&L

CONTINGENCY #3: GAP PROTECTION (User chose: YES)
  Rule: "On gap > 50 pips, skip first bar, trade from bar 2"
  
  Implementation:
    IF |current_open - previous_close| > 50pips THEN
      Flag as "Gap detected"
      Don't accept entries on bar 1
      Accept entries from bar 2 onwards
    ENDIF
  
  Impact on P&L:
    ├─ Skips ~1-2 false signals per month
    ├─ Protects from first-bar whipsaw
    ├─ Costs ~0.1% opportunity (miss 20-40 pips)
    ├─ Net benefit: Improved reliability

CONTINGENCY #4: SLIPPAGE ADJUSTMENT (User chose: YES)
  Rule: "If entry slippage > 5 pips, adjust SL to maintain fixed risk"
  
  Implementation:
    IF |actual_entry_price - intended_entry_price| > 5pips THEN
      slippage = |actual_entry_price - intended_entry_price|
      new_SL = original_SL - slippage
    ELSE
      new_SL = original_SL
    ENDIF
  
  Example:
    ├─ Intended: Enter 1.0800, SL 1.0700 (100 pips risk)
    ├─ Actual: Enter 1.0795 (5 pips slippage)
    ├─ New SL: 1.0695 (still 100 pips risk)
  
  Impact:
    ├─ Maintains exact risk intended
    ├─ No additional cost (just adjusts for reality)

FINAL CONTINGENCY LOGIC SPECIFICATION:
══════════════════════════════════════
All edge cases handled
All user preferences incorporated
Ready for mathematical re-validation
User Actions at Stage 4
User must explicitly handle each edge case:

☐ Choose option - A, B, C, or custom

☐ Approve contingency - Accept the formalized logic

☐ Review impact - Understand effect on P&L

☐ Move forward - Ready for Stage 5

STAGE 5: FORMAL SPECIFICATION & SIGN-OFF
Objective
Create final production-ready specification → Get user formal sign-off → Lock document

AI Steps
Step 5.1: Generate Final Specification Document

Combine all approved logic into single spec:

text
═══════════════════════════════════════════════════════════════════════════════
                    FINAL STRATEGY SPECIFICATION
                        VERSION 1.0 - LOCKED
═══════════════════════════════════════════════════════════════════════════════

Strategy Name: Oversold Bounce in Uptrend
Strategy Type: Reversal + Trend Following
Trader: [User name]
Date Created: 2026-01-09
Date Approved: 2026-01-09
Status: PRODUCTION READY (9.8/10 rating)

═══════════════════════════════════════════════════════════════════════════════
SECTION 1: ENTRY LOGIC
═══════════════════════════════════════════════════════════════════════════════

Entry Signal Conditions (ALL must be true):

1. TIME FILTER
   ├─ Approved: YES (User approved 2026-01-09 09:05:32)
   ├─ Rule: Only trade between 08:00 and 16:00 GMT
   ├─ Format: IF current_time >= 08:00 GMT AND current_time < 16:00 GMT
   ├─ Exception: None
   ├─ Impact: -40% of trading hours eliminated, but reduces gap risk
   └─ Tested: ✓ 12 test cases pass

2. OVERSOLD INDICATOR
   ├─ Approved: YES (User approved 2026-01-09 09:12:15)
   ├─ Rule: RSI(14) must drop below 30
   ├─ Format: IF RSI_period_14 < 30
   ├─ Parameter: RSI period = 14 (standard)
   ├─ Parameter: Threshold = 30 (oversold level)
   ├─ Impact: Creates 15% of candles as potential entries
   └─ Tested: ✓ 15 test cases pass

3. UPTREND FILTER
   ├─ Approved: YES - MODIFIED by User (2026-01-09 09:18:45)
   ├─ Original: Price > 200SMA
   ├─ Modified to: Price > 100EMA ← User changed
   ├─ Rule: Only in uptrends (bounces off support)
   ├─ Format: IF current_price > EMA_period_100
   ├─ Parameters: EMA period = 100, Comparison = >
   ├─ Impact: Eliminates downtrend entries (only long)
   └─ Tested: ✓ 14 test cases pass (updated for EMA)

4. CONFIRMATION REQUIREMENT
   ├─ Approved: YES (User approved 2026-01-09 09:22:10)
   ├─ Rule: Need 2 consecutive bars with RSI < 30
   ├─ Format: IF previous_bar_RSI < 30 AND current_bar_RSI < 30
   ├─ Purpose: Filter out false signals (90% false positive reduction)
   ├─ Cost: 1-bar entry delay
   ├─ Impact: Improves reliability from 56% → 92%
   └─ Tested: ✓ 10 test cases pass

ENTRY LOGIC SUMMARY:
  ALL four conditions must be TRUE simultaneously
  Probability: 15% × 0.05 × 92% = 0.69% of bars = ~11 entries per month
  Frequency: Roughly 2-3 entries per week

═══════════════════════════════════════════════════════════════════════════════
SECTION 2: EXIT LOGIC
═══════════════════════════════════════════════════════════════════════════════

Exit Rule Type 1: PROFIT EXIT (Winning trade)
  
  Approved: YES - MODIFIED by User (2026-01-09 09:27:33)
  Original: Fixed TP at +100 pips
  Modified: Removed fixed TP, use trailing stop instead
  
  New Rule: TRAILING STOP (User added, approved 2026-01-09 09:32:15)
  ├─ Trigger: Once profit exceeds +30 pips
  ├─ Trail amount: 20 pips below highest price reached
  ├─ Format: IF profit > 30pips THEN activate_trailing_SL at current-20pips
  ├─ Purpose: Let winners run, protect profits
  ├─ Impact: No fixed TP, could run 200+ pips, or exit at +20 pips min
  └─ Tested: ✓ 8 new test cases created and pass

Exit Rule Type 2: LOSS EXIT (Losing trade)
  
  Approved: YES (User approved 2026-01-09 09:35:40)
  Rule: Hard stop loss at -100 pips from entry
  Format: IF current_price <= (entry_price - 100pips) THEN exit
  Purpose: Risk management, defined loss per trade
  Impact: Loss capped at -100 pips (1% account if 0.1 lot)
  Tested: ✓ 12 test cases pass

Exit Rule Type 3: TIME EXIT (Time-based exit)
  
  Approved: YES - MODIFIED by User (2026-01-09 09:42:20)
  Original: Exit after 4 hours (4 one-hour bars)
  Modified: Exit after 6 hours (give reversal more time)
  Format: IF hours_held >= 6 THEN exit_at_market
  Purpose: Don't hold trades indefinitely
  Impact: Max hold time = 6 hours, then exit at current price
  Tested: ✓ 9 test cases pass

EXIT LOGIC SUMMARY:
  ├─ Win condition: Trailing stop (let winners run)
  ├─ Loss condition: Hard SL at -100 pips
  ├─ Time condition: Exit after 6 hours regardless
  ├─ Average hold time: 1-3 hours (based on backtest)
  └─ Exit logic is clear and unambiguous

═══════════════════════════════════════════════════════════════════════════════
SECTION 3: RISK MANAGEMENT
═══════════════════════════════════════════════════════════════════════════════

Position Size:
  ├─ Approved: YES
  ├─ Rule: Fixed 0.1 lot per trade
  ├─ Account size: $10,000
  ├─ Risk per trade: $100 (1% of account)
  ├─ Format: lot_size = 0.1 (always)
  └─ Impact: Predictable risk per trade

Maximum Positions:
  ├─ Approved: YES
  ├─ Rule: Only 1 position open at a time
  ├─ Format: IF num_open_positions >= 1 THEN reject_new_entries
  └─ Impact: No pyramiding or averaging

Daily Loss Limit:
  ├─ Approved: YES
  ├─ Rule: If cumulative loss > $500 in one day, stop trading
  ├─ Format: IF daily_loss >= 500 THEN stop_accepting_entries
  └─ Impact: Maximum loss per day = 5% of account

Maximum Drawdown:
  ├─ Approved: YES
  ├─ Rule: If account drops below $5,000 (50% of initial), stop trading
  ├─ Format: IF current_balance <= 5000 THEN stop_strategy
  └─ Impact: Account ruin becomes impossible (max loss = 50%)

RISK MANAGEMENT SUMMARY:
  ✅ Risk per trade: 1%
  ✅ Daily risk limit: 5%
  ✅ Account ruin protection: YES (at 50% drawdown)
  ✅ Position management: Clear and enforced

═══════════════════════════════════════════════════════════════════════════════
SECTION 4: CONTINGENCY RULES
═══════════════════════════════════════════════════════════════════════════════

Contingency #1: OVERNIGHT POSITION HANDLING
  ├─ Rule: Close all positions at 15:55 GMT (end of trading day)
  ├─ Format: IF current_time >= 15:55 THEN close_all_positions_at_market
  ├─ Reason: Eliminate gap risk overnight
  ├─ Approved: YES
  └─ Impact: No overnight gaps, but miss overnight moves

Contingency #2: NEWS EVENT AVOIDANCE
  ├─ Rule: Don't accept new entries 30 min before/after major news
  ├─ Events: FOMC, ECB, NFP, BOE (listed in appendix)
  ├─ Format: IF time_within_30min_of_major_news THEN reject_entries
  ├─ Reason: Avoid 100+ pip gaps from news
  ├─ Approved: YES
  └─ Impact: Miss ~15-20 news-related opportunities/year

Contingency #3: GAP PROTECTION
  ├─ Rule: If open > 50 pips from previous close, skip first bar
  ├─ Format: IF |current_open - previous_close| > 50 THEN skip_bar_1
  ├─ Reason: Avoid first-bar false signals after gaps
  ├─ Approved: YES
  └─ Impact: Miss ~1-2 false signals/month, slight opportunity cost

Contingency #4: SLIPPAGE ADJUSTMENT
  ├─ Rule: If entry slippage > 5 pips, adjust SL to maintain fixed risk
  ├─ Format: IF slippage > 5 THEN adjust_SL = SL - slippage
  ├─ Reason: Maintain intended risk level
  ├─ Approved: YES
  └─ Impact: No additional cost (automatic protection)

═══════════════════════════════════════════════════════════════════════════════
SECTION 5: MATHEMATICAL VALIDATION
═══════════════════════════════════════════════════════════════════════════════

Risk/Reward Analysis:
  ├─ TP: Trailing (no fixed target)
  ├─ SL: -100 pips (hard stop)
  ├─ Risk/Reward: Variable (trailing stop makes it dynamic)
  ├─ Average trade P&L: +45 pips (based on backtest)
  └─ Expected value: +$45 per trade (at 0.1 lot)

Win Rate Analysis:
  ├─ Backtest results: 52% win rate (208 wins, 192 losses)
  ├─ With trailing stop: 48% win rate, but larger winners
  ├─ Payoff ratio: Winners average +125 pips, losers average -95 pips
  └─ Expected P&L: 0.48 × 125 - 0.52 × 95 = 60 - 49.4 = +10.6 pips/trade

Account Viability:
  ├─ Per-trade cost: 2 pips (spread + slippage)
  ├─ Expected profit: 10.6 pips per trade
  ├─ Net expected profit: 8.6 pips per trade ($86 per trade)
  ├─ Average trades per month: 40 trades
  ├─ Expected monthly profit: $3,440
  ├─ Monthly ROI: 34.4% (exceptional if achievable)
  └─ Note: Real trading likely 20-30% worse than backtest

Account Ruin Probability:
  ├─ Risk per trade: 1% ($100)
  ├─ To account for 50% loss: Need 50 consecutive losing trades
  ├─ Probability of 50 losses in row: 0.48^50 = 0.00000000001% (impossible)
  └─ Verdict: Account ruin is statistically impossible

═══════════════════════════════════════════════════════════════════════════════
SECTION 6: TEST CASE SUMMARY
═══════════════════════════════════════════════════════════════════════════════

Total test cases created: 58
Test cases passed: 58 ✓
Test cases failed: 0 ✓
Overall pass rate: 100%

Breakdown by category:
├─ Entry logic tests: 15 ✓
├─ Exit logic tests: 18 ✓
├─ Risk management tests: 10 ✓
├─ Edge case tests: 12 ✓
└─ Contingency tests: 3 ✓

Sample test cases included in appendix

═══════════════════════════════════════════════════════════════════════════════
SECTION 7: APPROVAL HISTORY
═══════════════════════════════════════════════════════════════════════════════

All 11 conditions reviewed, approved, or modified:

✅ Condition 1 (Time Filter): APPROVED
✅ Condition 2 (RSI Entry): APPROVED
✅ Condition 3 (Uptrend Filter): MODIFIED (to EMA)
✅ Condition 4 (Confirmation): APPROVED
✅ Condition 5 (Exit TP): REMOVED → Replaced with trailing stop
✅ Condition 5a (Trailing Stop): ADDED by user
✅ Condition 6 (Exit SL): APPROVED
✅ Condition 7 (Exit Time): MODIFIED (to 6 hours)
✅ Risk Management: APPROVED
✅ Contingency Rules: APPROVED
✅ Mathematical Validation: APPROVED

All user-requested changes incorporated: ✓
All logic revalidated after changes: ✓
All test cases passing: ✓

═══════════════════════════════════════════════════════════════════════════════
SECTION 8: SIGN-OFF & FINALIZATION
═══════════════════════════════════════════════════════════════════════════════

Trader Name: _______________________
Trader Signature: _______________________
Date: 2026-01-09
Time: _______________

I confirm that:
☐ I have reviewed all sections of this specification
☐ All logic elements match my strategy intent
☐ All user modifications are correctly implemented
☐ I understand the risk and reward expectations
☐ I am ready for this specification to go to development

SPECIFICATION STATUS: LOCKED (Ready for Phase 3 development)

═══════════════════════════════════════════════════════════════════════════════

Appendix A: Test Cases (detailed)
Appendix B: Mathematical Calculations (detailed)
Appendix C: Change History (full audit trail)
Appendix D: Major News Events Calendar
Appendix E: Visual Logic Flowchart
Step 5.2: Create Amendment Tracking System

Enable future changes with full documentation:

text
AMENDMENT TRACKING SYSTEM
═════════════════════════

If you want to MODIFY specification AFTER lock:

AMENDMENT REQUEST FORM
──────────────────────

Amendment #: _______
Date requested: 2026-01-XX
Section affected: _______ (Entry / Exit / Risk Mgmt / Other)
Condition to change: _______

Original specification:
  [What it says now]

Desired change:
  [What you want to change it to]

Reason for change:
  [Why you want this change]

Impact analysis:
  [AI calculates impact on P&L, win rate, etc]

Test cases affected:
  [Which test cases must be updated]

Approval workflow:
  1. User submits amendment request
  2. AI analyzes impact
  3. AI creates new test cases
  4. User approves or rejects
  5. If approved: Update specification with version history
  6. If rejected: Maintain current specification

Example amendment:
──────────────────

Amendment #1: Change SL from -100 to -50 pips

Original: "Hard stop loss at -100 pips"
Desired: "Hard stop loss at -50 pips"
Reason: "Reduce per-trade risk"

Impact:
  • Risk per trade: $100 → $50 (50% reduction)
  • Win rate requirement: 50% → 33%
  • Expected monthly profit: -40% (fewer winning pips)
  • Probability of hitting daily limit: +80%

New test cases created: 6
Result: 6/6 pass ✓

User approval: YES / NO / REQUEST MODIFICATIONS
User Actions at Stage 5
User must:

☐ Review final specification completely

☐ Confirm all logic matches their intent

☐ Approve all sections

☐ Sign the formal approval

☐ Lock document (no more changes without formal amendment)

QUALITY GATES & CHECKPOINTS
Gate 1: After Stage 1 (Initial Logic)
text
STAGE 1 CHECKPOINT
═══════════════════

✓ Rough logic created from user input
✓ All major conditions identified
✓ Flowchart visually represents strategy
✓ Specification draft exists (0% approved)

PASS CRITERIA:
✓ User says "Yes, this matches my strategy"
✓ No major missing conditions
✓ Flowchart makes sense

GATE STATUS: [PASS] → Proceed to Stage 2
or [FAIL] → Restart Stage 1 with corrections
Gate 2: After Stage 2 (Math & Test Cases)
text
STAGE 2 CHECKPOINT
═════════════════

✓ Mathematical validation complete
✓ All edge cases identified
✓ 50+ test cases created
✓ All test cases passing

PASS CRITERIA:
✓ Math validates strategy is viable
✓ Account ruin is impossible
✓ Win rate achievable
✓ No logical contradictions

GATE STATUS: [PASS] → Proceed to Stage 3
or [FAIL] → Restart Stage 2 (refine logic)
Gate 3: After Stage 3 (Condition Approval)
text
STAGE 3 CHECKPOINT
══════════════════

✓ Every condition reviewed individually
✓ User approved/modified/removed each
✓ Approval history complete
✓ All changes documented

PASS CRITERIA:
✓ 100% of conditions explicitly approved
✓ All modifications logged
✓ Test cases re-run for each change
✓ No ambiguities remain

GATE STATUS: [PASS] → Proceed to Stage 4
or [FAIL] → Restart Stage 3 (clarify conditions)
Gate 4: After Stage 4 (Edge Cases)
text
STAGE 4 CHECKPOINT
══════════════════

✓ All major edge cases resolved
✓ Contingency logic documented
✓ User chose option for each scenario
✓ Impact on P&L calculated

PASS CRITERIA:
✓ Gap handling defined
✓ News risk handled
✓ Overnight position plan exists
✓ Slippage adjustment specified

GATE STATUS: [PASS] → Proceed to Stage 5
or [FAIL] → Restart Stage 4 (resolve edge cases)
Gate 5: After Stage 5 (Final Specification)
text
STAGE 5 CHECKPOINT
═════════════════

✓ Final specification generated
✓ All sections complete
✓ User reviewed entire document
✓ User formally approved and signed

PASS CRITERIA:
✓ Specification is 100% clear
✓ No ambiguities or placeholders
✓ User confident in strategy
✓ Ready for developer (Phase 3)

GATE STATUS: [PASS] → READY FOR DEVELOPMENT (Phase 3)
or [FAIL] → Restart Stage 5 (clarify specification)
UNRESTRICTED AI THINKING GUIDELINES
How AI Should Think at Each Stage
Stage 1 (Discovery):

Ask probing questions to understand true strategy

Challenge vague statements

Suggest alternatives based on strategy type

Identify potential logical gaps

Propose optimizations

Stage 2 (Validation):

Question math rigorously

Look for impossible scenarios

Identify contradictions

Calculate real-world costs (slippage, commission)

Simulate stress scenarios

Point out risks user might have missed

Stage 3 (Approval):

Don't accept vague approvals ("yes that's fine")

Force explicit confirmation for each condition

Ask why user chose this specific value

Suggest alternatives with pros/cons

Calculate impact of each condition independently

Stage 4 (Edge Cases):

Think creatively about failure scenarios

Propose multiple solutions, not just one

Calculate probability and impact of each edge case

Identify which cases are most likely to occur

Suggest contingency rules that are easy to implement

Stage 5 (Finalization):

Ensure specification is 100% unambiguous

Verify no placeholders remain

Confirm all test cases still pass

Create audit trail of all changes

Make it ready to hand to developer

What NOT to Do
❌ Don't be a rubber stamp

Example: User says "RSI < 30" → Don't just accept

Better: Ask why 30? Did you test 25 or 35? What does testing show?

❌ Don't ignore contradictions

Example: User wants 90% win rate AND 1:5 risk/reward

Better: "These are mathematically incompatible. Let's align them."

❌ Don't hide assumptions

Example: Assume user wants fixed TP

Better: "Should we use fixed TP or trailing stop? Let me show you both options."

❌ Don't move forward with ambiguity

Example: User says "trade around news"

Better: "Do you mean avoid news, or trade more aggressively during news?"

USER APPROVAL WORKFLOW
Continuous Approval Loop
At ANY point in ANY stage, user can:

text
USER ACTIONS (Pick one):
─────────────────────────

A) APPROVE
   "Yes, this is correct"
   → Element locked
   → Move forward
   → Document timestamp and signature

B) MODIFY
   "Change this to: _______"
   → AI implements change
   → Regenerate test cases
   → Re-validate logic
   → Present for re-approval

C) REMOVE
   "Delete this element"
   → Element removed
   → Dependent elements updated
   → Test cases deleted
   → Remaining logic re-validated

D) ADD
   "Add new condition: _______"
   → AI formalizes new logic
   → Creates test cases
   → Validates against existing logic
   → Presents for approval

E) CHALLENGE
   "I don't understand why..."
   → AI explains reasoning
   → Provides examples
   → Shows test cases
   → User can still APPROVE/MODIFY/REMOVE after understanding

F) REQUEST ANALYSIS
   "What if _______?"
   → AI runs scenario
   → Shows impact on P&L
   → Calculates probability
   → User decides what to do about it

G) REJECT ALL
   "This is wrong"
   → AI rolls back
   → Restarts current stage
   → Can modify approach

USER TIMELINE:
──────────────
Day 1 (Stages 1-2): 2-3 hours
Day 2 (Stage 3): 1-2 hours
Day 3 (Stages 4-5): 1-2 hours
───────────────────────────────
Total: 4-7 hours to complete
IMPLEMENTATION CHECKLIST
Before Starting This Phase
 User has existing strategy (description, backtest results)

 User has clear idea of entry/exit logic

 User knows their risk tolerance

 User has time to iterate (4-7 hours over 2-3 days)

 User is ready to approve/modify/remove logic elements

During This Phase
 Every condition explicitly documented

 Every condition explicitly approved by user

 Every change tracked with timestamp

 Test cases created and passing

 Math validated

 Edge cases handled

 No ambiguities remain

After This Phase
 User has signed-off on final specification

 Specification is locked

 Document is ready to hand to developer

 Amendment process is in place for future changes

 Ready for Phase 3: Development

SUMMARY: ULTIMATE MERGED PHASE
This single phase:
✅ Builds strategy logic from user input (Phase 1)
✅ Refines and validates logic (Phase 2)
✅ Gets explicit user approval for every element
✅ Enables user to add/remove/modify any rule
✅ Creates 50+ test cases validating all logic
✅ Produces production-ready specification (9.8/10)
✅ Provides audit trail of all decisions
✅ Locks document with formal sign-off

User has complete control:

Approve any condition

Modify any parameter

Remove any rule

Add new conditions

Challenge AI suggestions

Request analysis

Iterate until comfortable

Output quality:

Every rule is testable

Every condition is quantifiable

No ambiguities or placeholders

Can pass directly to developer

Risk management is explicit

Math is validated

Edge cases are handled